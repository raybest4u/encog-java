<!-- 
 Encog Artificial Intelligence Framework v2.x
 Java Version - Workbench
 http://www.heatonresearch.com/encog/
 http://code.google.com/p/encog-java/
  
 Copyright 2008-2009, Heaton Research Inc., and individual contributors.
 See the copyright.txt in the distribution for a full listing of 
 individual contributors.
 
 This is free software; you can redistribute it and/or modify it
 under the terms of the GNU Lesser General Public License as
 published by the Free Software Foundation; either version 2.1 of
 the License, or (at your option) any later version.
 
 This software is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 Lesser General Public License for more details.
 
 You should have received a copy of the GNU Lesser General Public
 License along with this software; if not, write to the Free
 Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<project name="java-encog-workbench" default="dist" basedir=".">
	<description>
        Build the Workbench JAR file for Encog.
    </description>
	<!-- set global properties for this build -->
	<property name="path.src" location="${basedir}/src" />
	<property name="path.build" location="${basedir}/build" />
	<property name="path.build.util" location="${basedir}/util" />
	<property name="path.dist" location="${basedir}/dist" />
	<property name="path.stage.win" location="${basedir}/stagewin" />
	<property name="path.stage.src" location="${basedir}/stagesrc" />
	<property name="path.stage.univ" location="${basedir}/stageuniv" />
	<property name="path.jar" location="${basedir}/jar" />
	<path id="classpath">
		<fileset dir="${path.jar}" />
	</path>

	<target name="checkout" depends="init">
		
		<exec executable="svn">			
			<arg value="checkout" />
			<arg value="http://encog-java.googlecode.com/svn/trunk/encog-workbench" />
			<arg value="${basedir}" />
		</exec>
		
		<exec executable="svn">			
			<arg value="checkout" />
			<arg value="http://encog-java.googlecode.com/svn/trunk/encog-build" />
			<arg value="${path.build.util}" />
		</exec>
	</target>

	<target name="init">
		<!-- Create the build directory structure used by compile -->
		<mkdir dir="${path.build}" />		
		
	</target>

	<target name="compile" depends="init" description="compile the source ">
	
		<javac srcdir="${path.src}" source="1.5" target="1.5" destdir="${path.build}">
			<classpath refid="classpath" />
		</javac>

	</target>

	<target name="dist" depends="compile" description="generate the distribution">

		<!-- Create the distribution directory -->
		<mkdir dir="${path.dist}" />
		
		<!-- Get the program version -->
		<exec executable="svn">			
			<arg value="export" />
			<arg value="http://encog-java.googlecode.com/svn/trunk/encog-core/src/org/encog/Encog.java" />
		</exec>

		<loadfile srcfile="${basedir}/Encog.java" property="build.version">
			<filterchain>
				<linecontainsregexp>
					<regexp pattern='^.*String VERSION = ".*";.*$' />
				</linecontainsregexp>
				<tokenfilter>
					<replaceregex replace='\1' pattern='^.*String VERSION = "(.*)";.*$' />
				</tokenfilter>
				<striplinebreaks />
			</filterchain>
		</loadfile>
		

		<manifest file="MANIFEST.MF">
			<attribute name="Built-By" value="${user.name}" />
			<attribute name="Implementation-Version" value="${version.num}-b${build.version}" />
		</manifest>

		<property name="jarfile" location="${path.jar}/encog-workbench-${build.version}.jar" />
		
		<copy todir="${path.build}/resource">
			<fileset dir="${path.src}/resource" />
		</copy>

		<jar jarfile="${jarfile}" basedir="${path.build}" manifest="MANIFEST.MF" />

	</target>

	<target name="cc-build" depends="clean-all,checkout,compile,dist">
	
		<mkdir dir="${path.stage.win}" />
		<mkdir dir="${path.stage.src}" />
		<mkdir dir="${path.stage.univ}" />
		
		<tstamp/>

		<!-- Create Windows distributable -->		
		<copy todir="${path.stage.win}/jar">
			<fileset dir="${path.jar}" />
		</copy>
		<copy todir="${path.stage.win}" file="${basedir}/copyright.txt" />
		
		<java classname="org.encog.workbench.util.JavaClassPathUtil">
			<classpath refid="classpath" />
			<arg value="${path.stage.win}"/>
		</java>
		
		<java classname="org.encog.workbench.util.JavaLaunchUtil">
			<classpath refid="classpath" />
			<arg value="${path.stage.win}"/>
			<arg value="${path.build.util}"/>
		</java>
		
		<exec executable="launch4jc" dir="${path.build.util}">			
			<arg value="launch.xml" />
		</exec>

		<zip destfile="${path.dist}/encog-workbench-win-${build.version}-${DSTAMP}-${TSTAMP}.zip">
			<fileset dir="${path.stage.win}" />
		</zip>
		
		<!-- Create Source distributable -->
		<copy todir="${path.stage.src}" file="${basedir}/build.xml" />
		<copy todir="${path.stage.src}" file="${basedir}/.classpath" />
		<copy todir="${path.stage.src}" file="${basedir}/.project" />
		<copy todir="${path.stage.src}" file="${basedir}/copyright.txt" />

		<copy todir="${path.stage.src}/src">
			<fileset dir="${path.src}" />
		</copy>
		
		<copy todir="${path.stage.src}/jar">
			<fileset dir="${path.jar}" />
		</copy>

		<zip destfile="${path.dist}/encog-workbench-src-${build.version}-${DSTAMP}-${TSTAMP}.zip">
			<fileset dir="${path.stage.src}" />
		</zip>
		
		<!-- Create Universal distributable -->
		<copy todir="${path.stage.univ}/jar">
			<fileset dir="${path.jar}" />
		</copy>
		<copy todir="${path.stage.univ}" file="${basedir}/copyright.txt" />
		
		<java classname="org.encog.workbench.util.JavaClassPathUtil">
			<classpath refid="classpath" />
			<arg value="${path.stage.univ}"/>
		</java>
		
		<zip destfile="${path.dist}/encog-workbench-univ-${build.version}-${DSTAMP}-${TSTAMP}.zip">
			<fileset dir="${path.stage.univ}" />
		</zip>


	</target>

	<target name="clean-all" depends="clean" description="Delete the source code">
		<delete dir="${path.src}" />
		<delete>
			<fileset dir="${basedir}" excludes="build.xml" />
		</delete>
	</target>

	<target name="clean" description="clean up">
		<!-- Delete the ${build} and ${dist} directory trees -->
		<delete dir="${path.stage.win}" />
		<delete dir="${path.stage.src}" />
		<delete dir="${path.stage.univ}" />
		<delete dir="${path.jar}" />
		<delete dir="${path.build}" />
		<delete dir="${path.build.util}" />
		<delete dir="${path.dist}" />
		<delete dir="${basedir}/samples" />
	</target>
</project>